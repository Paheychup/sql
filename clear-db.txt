Как правило, очистка проводится в субботу.

Разделена на 3 основных этапа:

Подготовительный
Отключаем шедулер по запуску сервера и сабсерверов в режиме выходного дня. Можно сделать заранее, в пятницу или выключаем сервер и сабсервер непосредственно перед чисткой;
При очистке DSP или М1 отключить webquik + для DSP отключить QUpdateUser. (если предполагается, что очистка будет продолжаться и до воскресенья, отключить и шедулеры);
Отключить шедулер SyncUser, отключить службу Qadmin (если предполагается, что очистка будет продолжаться и до воскресенья, отключить и шедулер);
Закомментить мониторинг сервера или закрыть Qmonitor;
Убрать или закомментировать в ini файле sms шлюза и репликатора нужный сервер. В ini файле sms шлюза 3 секции, которые нужно комментировать.
Перезапустить шлюз для вступления в силу;
Проверить процедуры и Job-ы, которые работают с базой;
Перевести базу в Offlinе, затем Online, также попробовать переименовать БД;
Забэкапить БД сервера;
Замерить текущий размер базы


Размер базы
--Узнаем общий размер БД
   SELECT SUM(CAST(size / 128.0 AS DECIMAL(17,2))) AS [Размер в MB]
   FROM sys.database_files
 
   --Узнаем размер каждого файла в БД
   SELECT name AS [Логическое имя файла], 
       physical_name AS [Путь и имя файла в ОС],
       state_desc AS [Состояние файла],
       CAST(size / 128.0 AS DECIMAL(17,2)) AS [Размер в MB]
   FROM sys.database_files


Перенести бэкап на Everydaybackup в папку Архивные базы, указать за какой диапозон времени в этом архиве данные
Можно для уточнения диапазона времени использовать запросы:
Диапазон базы
select min(server_time) from TRANS
select max(server_time) from TRANS
Очистка
Очистка данных из базы: Чистим таблицы скриптом Clear_DB_Quik.sql
В скрипте необходимо указать дату до которой чистим в двух местах, а также убедиться, что в начале указано корректное имя базы, которую чистим.

Выполняем дефрагментация: (Пункт не обязательный, см. Примечания)
DB_Quik_Index_Optim.sql: запустит процесс реорганизации и/или перестроения индексов в зависимости от степени фрагментации.

Шринк базы. Рекомендуется выполнять частями. Это можно сдлеать скриптом или через интерфейс.
Через интерфейс это делается во вкладке Task > Shrink > File

Выбираем размер, до которого планируем сжать базу, но не ниже указанного минимума.



Снова проверяем размер БД и фиксируем изменение.
Восстановление
После манипуляций переносим копию бэкапа базы на сервер 
(На случай, если будут проблемы с запуском сервера и нужно будет развернуть прошлую БД
Удалить после успешного запуска)
Вернуть первоначальное имя БД (если проводили чистку на переименованной)
Включить запуск в режиме выходного дня сервер и сабсерверов
Вернуть или раскомментировать в ini файле sms шлюза и репликатора нужный сервер
При очистки DSP или М1 включить webquik + для DSP включить QUpdateUser
В воскресенье проверить, что сервер успешно подключился, и к нему подключились sms, репликатор и сервера доступа
Отмечаем на странице Бэкапы БД Quik (backup database) и STA файлов информацию о местонахождении архива
В конце необходимо зафиксировать в инструкции Бэкапы БД Quik (backup database) и STA файлов маршрут, куда был выложен архив базы

Примечания
Очистка как правило занимает 2 дня, если считать в совокупности работу скрипта по чистки и последующий шринк. Рекомендуется сразу выполнять действия с расчётом на то,чтобы на второй день (воскресенье) никакие модели или job-ы не обратились к базе (как правило, переводить в Disable). В случае возникновения ошибок во время работы скриптов (зависла машина или перезагрузилась) необходимо начать заново. То есть развернуть БД до чистки и снова запускать скрипты. 

В БД на всех серверах Quik у нас имеется Job для дефрагментации индексов. Запускается он рано утром в воскресенье. Следует выключить Job, если предполагается, что в это время ещё будет идти чистка (или шринк). После, вернуть Job в активное состояние и можно запустить дефрагментацию через него.