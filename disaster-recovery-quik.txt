
Перейти к концу метаданных
Создатель Рамазанов Рамазан Сергеевич, отредактировано 08.02.2022Переход к началу метаданных
1. Подготовка к Disaster recovery
1.1 Для выбранного на тестирование сервера отключаем плановый старт сервера и серверов доступа за день до тестирования. На основном сервере DSP необходимо своему терминалу дать права на активные операции (на следующий день права реплицируются на все сервера), чтобы на тестировании можно было отправлять тестовые поручения;

1.2 Удаляем (предварительно сделав бэкап) или комментируем выбранный сервер в конфигурационных файлах репликатора (ReplTW.ini) и смс шлюза (SMS.ini). Можно выполнить также за день до тестирования, настройки вступят в силу на следующий день после рестарта. Также проверяем расписание работы Syncuser и при необходимости тоже отключаем (если его запуск выпадает на время тестирования);

1.3 Делаем бэкап базы выбранного сервера (рекомендуется его переименовать, чтобы случайно не затереть другим бэкапом), директорий шлюзов Asts и Fortsgate, сервера и одного сервера доступа. По возможности, стоит выбирать сервер доступа внутренний, так как на него не подключаются клиенты. Если по какой-то причине был выбран другой СД, то необходимо либо изменить порт, который слушает СД, либо сделать для него DrainStop в балансировщике, чтобы на него не попали клиенты. Выключаем Qmonitor утром в день тестирования;

1.4 Перед стартом сервера в quik.ini в секции [trade_date] необходимо указать 2 дня подряд holiday. Пример:

[trade_date] 

20220128=holiday
20220127=holiday

Биржа предварительно сообщит, под каким днём будет запущена их торговая система. Настройку holiday нужно указать для двух следующих дней, после указанной биржей даты (в примере выше сервер запуск осуществляется как-будто сегодня 20220126)

1.5 Согласно расписанию тестирования, запускаем сервер с загрузкой одного из прошлых файлов с лимитами (для этого один из старых файлов с лимитами переименовываем в lim.lim и запускаем сервер по шедулеру) и запускаем выбранный для тестирования сервер доступа и шлюзы. В шлюзе FortsGate может потребоваться изменить пароль на подключения к тестированию (дополнительно об этом сообщит биржа в своей инструкции).

2. Проведение Disaster recovery
2.1 Проверяем в Qmonitor, что нет лишних подключений на сервер (других СД, клиентов, экспортёров и пр.);

2.2 Проверяю наличие данных через рабочее место Quik (котировки и графики) по всем рынкам. Рекомендуется заранее настроить нужные таблицы себе в рабочем месте;

2.3 Проверяем подачу торговых поручений и их отображение в таблице поручений и в стакане. В случаем возникновения ошибки или отсутствия каких-либо данных, обращаемся на биржу (в зависимости от характера проблемы, возможно потребуется обратиться в Арку);

2.4 Дожидаюсь имитации сбоя. Биржа может потребовать перед возобновлением работы на резерве очистить данных из своих торговых систем.

Сценарий зачистки:
- стоп всех шлюзов, включая мультихабы, если есть.
- перезапуск сервера с ключом -new
- старт шлюзов.

2.5 Также для запуска шлюза срочного рынка на резерве может потребоваться изменить адреса подключения в SpectraCGate. Адреса можно уточнить у биржи, но вероятно это адреса из файла C:\Moscow Exchange\SpectraCGate\links\links_public.rezerv.ini Адреса основного шлюза прописаны в файле links_public.prod.ini Поэтому, может быть достаточно внести изменение в файл C:\Moscow Exchange\SpectraCGate\client_router.ini

[ROUTEINFO]
.................................
connections_ini=C:\Moscow Exchange\SpectraCGate\links\links_public.prod.ini > links_public.rezerv.ini

2.6 После старта шлюзов на резерве проверяем получение данных и подачу поручений;

2.7 Далее торговая система биржи будет переключена обратно, на основной контур. Нужно также дождаться, когда контур станет доступен и проверить подключение к нему, а также получение данных (возможность выставлять торговые поручения и наличие стаканов цен здесь следует уточнить у биржи). Потребуется также откатить настройку из пункта 2.5 и может потребоваться вернуть боевой пароль, который меняли в пункте 1.5 (лучше уточнить у биржи).

3. После окончания Disaster recovery

3.1 Отключаем сервер, сервер доступа и все шлюзы, что участвовали в тестировании. Переносим директории этих программ в отдельный каталог (на случай дополнительного разбора если понадобится). После, по согласованию с руководством, эти копии можно будет удалить. Переименовываем файл с лимитами lim.lim, который загружали для теста;

3.2 Возвращаем из бэкапа директорию сервера, сервера доступа и всех шлюзов на место, разворачиваем бэкап базы с перезаписью текущей базы;

3.3 Запускаем сервер в режиме выходного дня. Возвращаем данные в конфиг репликатора и смс шлюза и перезапускаем их. Возвращаем в планировщике старт всех серверов доступа и запускаем их. Если Syncuser отключали в планировщике, возвращаем плановый старт. Запускаем Qmonitor на мониторинговой машине;

3.4 Проверяем возможность подключиться терминалом, а также все подключение всех шлюзов, согласно расписанию выходного дня.



Примечания:
От биржи также поступит инструкция и расписание тестирования, поэтапно. Следует обратить внимание на необходимость менять параметры подключения к ТС биржи на нашей стороне, изменённые пароли. Также может повлиять выбранный сервер и схема его подключения. Используемые у нас схемы Collacation (DSP и Vserv) и ConnectMe (M1 и Iteco).